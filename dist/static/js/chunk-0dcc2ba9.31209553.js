(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0dcc2ba9"],{"1506f":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("sticky",{attrs:{"z-index":10,"class-name":"sub-navbar"}},[a("div",{staticClass:"page-title"},[a("div",{staticClass:"title-container"},[a("router-link",{staticClass:"back-link",attrs:{to:"/#/areas/index"}},[a("font-awesome-icon",{staticClass:"icon-back",attrs:{icon:"chevron-left",color:"#424242"}})],1),t._v(" "),a("router-link",{staticClass:"title-page",attrs:{to:"/#/users/areas/index",title:"DashBoard"}},[t._v("\n            "+t._s(t.generateTitleView("editMap","area"))+"\n          ")])],1),t._v(" "),a("div",{staticClass:"action-container"},[a("el-button",{staticClass:"btn-create-hotel",attrs:{icon:"el-icon-upload",type:"primary"},on:{click:t.showUploadImage}},[t._v("\n            "+t._s(t.generateTitleView("uploadImage","createMap"))+"\n          ")]),t._v(" "),a("el-button",{staticClass:"btn-create-hotel",attrs:{icon:"el-icon-download",type:"danger"},on:{click:t.addObject}},[t._v("\n            "+t._s(t.generateTitleView("saveSetting","createMap"))+"\n          ")])],1)])]),t._v(" "),a("div",{staticClass:"create-map_wrapper"},[a("div",{staticClass:"edit-wrap"},[a("div",{ref:"editorCanvas",staticClass:"editor-canvas"},[a("img",{ref:"imageMap",staticClass:"imp-editor-image",attrs:{src:t.thumbUrl,alt:""}}),t._v(" "),a("div",{attrs:{id:"imp-editor-shapes-container"}},[a("svg",{staticClass:"svg-editor",on:{click:t.addPoint}},t._l(t.points,(function(e,i){return a("circle",{key:i,attrs:{cx:e.x,cy:e.y,r:"4",fill:t.getPointFill(e)}})})),0)])])]),t._v(" "),a("v-card",{staticClass:"tool-wrap"},[a("el-scrollbar",{attrs:{id:"wcp-editor-object-settings"}},[a("div",{staticClass:"setting-header"},[t._v("\n            "+t._s(t.generateTitleView("proberty","createMap"))+"\n          ")]),t._v(" "),"addObject"==t.selectedTool||"editObject"==t.selectedTool?a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:t.points.length>0,expression:"points.length > 0"}],staticClass:"setting-content"},[a("div",{staticClass:"setting-title"},[a("span",{staticClass:"label"},[t._v(t._s(t.generateTitleView("objectTitle","createMap")))]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formCreate.title,expression:"formCreate.title"}],attrs:{type:"text",required:""},domProps:{value:t.formCreate.title},on:{input:function(e){e.target.composing||t.$set(t.formCreate,"title",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"setting-title"},[a("span",{staticClass:"label"},[t._v("Delta x (mét)")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formCreate.deltax,expression:"formCreate.deltax"}],attrs:{type:"text",required:""},domProps:{value:t.formCreate.deltax},on:{input:function(e){e.target.composing||t.$set(t.formCreate,"deltax",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"setting-title"},[a("span",{staticClass:"label"},[t._v("Delta y (mét)")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.formCreate.deltay,expression:"formCreate.deltay"}],attrs:{type:"text",required:""},domProps:{value:t.formCreate.deltay},on:{input:function(e){e.target.composing||t.$set(t.formCreate,"deltay",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"setting-title"},[t._v("\n                Danh sách điểm\n              ")]),t._v(" "),t._l(t.points,(function(e,i){return a("div",{key:i,staticClass:"setting-item"},[a("span",[t._v("X"+t._s(i+1)+" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.x,expression:"item.x"}],staticClass:"input-point",attrs:{type:"number"},domProps:{value:e.x},on:{change:t.changePoint,input:function(a){a.target.composing||t.$set(e,"x",a.target.value)}}})]),t._v(" "),a("span",{staticClass:"setting-item__right"},[t._v("Y"+t._s(i+1)+" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.y,expression:"item.y"}],staticClass:"input-point",attrs:{type:"number"},domProps:{value:e.y},on:{input:function(a){a.target.composing||t.$set(e,"y",a.target.value)}}})]),t._v(" "),a("el-button",{staticClass:"el-edit",attrs:{icon:"el-icon-edit"},on:{click:function(e){return t.setPoint(i)}}}),t._v(" "),a("font-awesome-icon",{staticClass:"fa-remove",attrs:{icon:"times"},on:{click:function(e){return t.removePoint(i)}}})],1)}))],2)]):t._e()]),t._v(" "),a("div",{staticClass:"object-list-wrap-title"},[a("font-awesome-icon",{staticClass:"iconMinus",attrs:{icon:"minus"}}),t._v(" "),a("el-select",{staticClass:"selectObj",attrs:{size:"small"},model:{value:t.filterListObject,callback:function(e){t.filterListObject=e},expression:"filterListObject"}},[a("el-option",{attrs:{value:"0",label:"Danh sách đối tượng"}})],1)],1),t._v(" "),a("el-scrollbar",{attrs:{id:"wcp-editor-object-list-wrap","view-class":"yf-content"}},t._l(t.objectListFilter,(function(e,i){return a("div",{key:i,staticClass:"object-item",class:{active:t.selectedObject.id==e.id}},["object"===e.type?a("span",{staticClass:"titleWidth",on:{click:function(a){return t.selectObject(e)}}},[t._v(t._s(e.name))]):a("span",{staticClass:"titleWidth",on:{click:function(a){return t.selectObject(e)}}},[t._v(t._s(e.camera.name))]),t._v(" "),a("font-awesome-icon",{staticClass:"fa-remove",attrs:{icon:"times"},on:{click:function(e){return t.removeObject(i)}}})],1)})),0)],1)],1),t._v(" "),a("div",{staticClass:"vb-tools"},[a("div",{staticClass:"tool-item",on:{click:t.showUploadImage}},[a("md-tooltip",{attrs:{"md-direction":"right"}},[t._v(t._s(t.generateTitleView("uploadImage","createMap")))]),t._v(" "),a("md-icon",[t._v("cloud_upload")])],1),t._v(" "),a("div",{staticClass:"tool-item",class:{active:"addObject"==t.selectedTool},on:{click:function(e){return t.selectTool("addObject")}}},[a("md-tooltip",{attrs:{"md-direction":"right"}},[t._v(t._s(t.generateTitleView("addObject","createMap")))]),t._v(" "),a("font-awesome-icon",{attrs:{icon:"plus-circle"}})],1),t._v(" "),a("div",{staticClass:"tool-item",on:{click:t.showMapSetting}},[a("md-tooltip",{attrs:{"md-direction":"right"}},[t._v(t._s(t.generateTitleView("settingMap","createMap")))]),t._v(" "),a("font-awesome-icon",{attrs:{icon:"cog"}})],1)]),t._v(" "),a("v-dialog",{attrs:{"max-width":"210"},model:{value:t.dialogUploadImage,callback:function(e){t.dialogUploadImage=e},expression:"dialogUploadImage"}},[a("v-card",{staticClass:"dialogUploadImage"},[a("vue-upload-multiple-image",{attrs:{"data-images":t.images,"id-upload":"myIdUpload","edit-upload":"myIdEdit",multiple:!1,"drag-text":t.generateTitleView("dragImage","createMap")},on:{"upload-success":t.uploadImageSuccess,"edit-image":t.editImage}})],1)],1),t._v(" "),a("v-dialog",{attrs:{"max-width":"450"},model:{value:t.dialogMapSetting,callback:function(e){t.dialogMapSetting=e},expression:"dialogMapSetting"}},[a("v-card",{staticClass:"dialogMapSetting"},[a("span",{staticClass:"realSize"},[t._v("Kích thước thực tế (mét)")]),t._v(" "),a("v-text-field",{attrs:{label:t.generateTitleView("width","createMap"),outlined:"",dense:""},model:{value:t.areaObject.width,callback:function(e){t.$set(t.areaObject,"width",e)},expression:"areaObject.width"}}),t._v(" "),a("v-text-field",{attrs:{label:t.generateTitleView("height","createMap"),outlined:"",dense:""},model:{value:t.areaObject.height,callback:function(e){t.$set(t.areaObject,"height",e)},expression:"areaObject.height"}}),t._v(" "),a("md-dialog-actions",[a("button",{staticClass:"btn-control btn-primary",on:{click:t.saveMapSetting}},[t._v(t._s(t.generateTitleView("Save","createMap")))]),t._v(" "),a("button",{staticClass:"btn-control",on:{click:function(e){t.dialogMapSetting=!1}}},[t._v(t._s(t.generateTitleView("close","camera"))+"\n          ")])])],1)],1)],1)},s=[];a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s}))},"153d":function(t,e,a){},"3c05":function(t,e,a){"use strict";a.r(e);var i=a("be42"),s=a.n(i);for(var n in i)"default"!==n&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=s.a},7954:function(t,e,a){"use strict";var i=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.checkNumber=o,e.exportExcel=r,e.parseTime=l,e.formatTime=c,e.param2Obj=d,e.checkEmail=u,e.hasClass=m,e.addClass=p,e.removeClass=f,e.hasPermissionAction=h,e.data2blob=g,a("34ef"),a("6762"),a("2fdb"),a("3b2b"),a("4917"),a("28a5"),a("f576"),a("a481"),a("6b54");var s=i(a("7037"));a("c5f6"),a("7cdf");var n=a("5c96");function o(t,e,a){var i=parseFloat(e);return 0===i?a():i?void setTimeout((function(){Number.isInteger(i)?i<=0?a(new Error("Vui lòng nhập số lớn hơn hoặc bằng 0")):i>1e10?a(new Error("Vui lòng nhập số nhỏ hơn 10 tỷ")):a():a(new Error("Vui lòng nhập số"))}),1e3):a(new Error("Phải là số lớn hơn hoặc bằng 0"))}function r(t){}function l(t,e){if(0===arguments.length)return null;var a,i=e||"{y}-{m}-{d} {h}:{i}:{s}";"object"===(0,s.default)(t)?a=t:("string"===typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"===typeof t&&10===t.toString().length&&(t*=1e3),a=new Date(t));var n={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()},o=i.replace(/{([ymdhisa])+}/g,(function(t,e){var a=n[e];return"a"===e?["日","一","二","三","四","五","六"][a]:a.toString().padStart(2,"0")}));return o}function c(t,e){t=10===(""+t).length?1e3*parseInt(t):+t;var a=new Date(t),i=Date.now(),s=(i-a)/1e3;return s<30?"chỉ cần":s<3600?Math.ceil(s/60)+"vài phút trước":s<86400?Math.ceil(s/3600)+"vài giờ trước":s<172800?"1 ngày trước":e?l(t,e):a.getMonth()+1+"tháng"+a.getDate()+"ngày "+a.getHours()+" giờ"+a.getMinutes()+" phút"}function d(t){var e=t.split("?")[1];return e?JSON.parse('{"'+decodeURIComponent(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"').replace(/\+/g," ")+'"}'):{}}function u(t){var e=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)}function m(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function p(t,e){m(t,e)||(t.className+=" "+e)}function f(t,e){if(m(t,e)){var a=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(a," ")}}function h(t,e,a,i){return t.includes(e)?(""!==a&&(window.location.href="/#/"+a),!0):((0,n.Message)({message:i,type:"error",duration:5e3}),!1)}function g(t,e){t=t.split(",")[1],t=window.atob(t);for(var a=new Uint8Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([a],{type:e})}},"92eb":function(t,e,a){"use strict";a.r(e);var i=a("1506f"),s=a("3c05");for(var n in s)"default"!==n&&function(t){a.d(e,t,(function(){return s[t]}))}(n);a("f172");var o=a("2877"),r=Object(o["a"])(s["default"],i["a"],i["b"],!1,null,"1f2021b0",null);e["default"]=r.exports},be42:function(t,e,a){"use strict";var i=a("dbce"),s=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("6b54");var n=s(a("6374"));a("7f7f");var o=s(a("ded3")),r=s(a("b804")),l=a("7954"),c=a("6087"),d=a("2f62"),u=i(a("c8a9")),m=s(a("fc5c")),p=a("7954"),f=s(a("cff6")),h=s(a("7f8c")),g={model:"area/"},v={name:"CreateMap",components:{Sticky:r.default,VueUploadMultipleImage:m.default},data:function(){return{pointIndex:null,dialogMapSetting:!1,areaObject:{},dialogUploadImage:!1,images:[],folderUpload:"https://172.20.10.2:9000/agency/Images/User/",imgFormat:"png",allowedImgFormat:["jpg","png"],urlUpload:"file/upUserAvatar",currentUser:"",thumbUrl:"",selectedTool:"",points:[],fillOpacity:.5,fill:"blue",stroke:"gray",strokeWidth:1,pointsColor:"teal",formCreate:{title:"",id:null,deltax:0,deltay:0},objectList:[],selectedObject:"",mapSize:{},formCamera:{name:"",type:"camera",point:{}},filterListObject:"0"}},computed:(0,o.default)((0,o.default)({},(0,d.mapGetters)({language:"language"})),{},{pointsString:function(){var t=this.points.map((function(t){return t.x+","+t.y}),this);return t.join(" ")},objectListFilter:function(){var t=[];return"0"===this.filterListObject?t=this.objectList:"1"===this.filterListObject?t=this.objectList.filter((function(t){return"object"===t.type})):"2"===this.filterListObject&&(t=this.objectList.filter((function(t){return"camera"===t.type}))),t}}),mounted:function(){this.$store.commit("app/CHANGE_APP_TITLE","HỆ THỐNG GIÁM SÁT VÀ ĐIỀU KHIỂN ROBOT");var t=this.$router.currentRoute.params.id;"undefined"!==typeof t&&null!==t&&this.getArea(t),this.currentUser=this.$store.state.auth.name},methods:(0,o.default)((0,o.default)({},(0,d.mapActions)({actGetCurrentArea:g.model+u.ACT_FETCH_ONE_AREA,actUpdateThumb:g.model+u.ACT_UPDATE_THUMB,actUpdateJson:g.model+u.ACT_UPDATE_JSON,actEditArea:g.model+u.ACT_EDIT_AREA})),{},{generateTitleView:c.generateTitleView,hasPermissionAction:l.hasPermissionAction,getArea:function(t){var e=this;this.actGetCurrentArea(t).then((function(t){e.areaObject=t.payload.records,e.thumbUrl=e.folderUpload+e.areaObject.thumb,e.areaObject.jsonData&&(e.objectList=JSON.parse(e.areaObject.jsonData)["objectList"]),e.images=[{path:e.folderUpload+e.areaObject.thumb,default:1,highlight:1}]}))},showUploadImage:function(){this.dialogUploadImage=!0},uploadImageSuccess:function(){},editImage:function(t,e,a){setTimeout(function(){var t=this,e=a[0].path,i=new FormData,s=-1===this.allowedImgFormat.indexOf(this.imgFormat)?"jpg":this.imgFormat,n=f.default[s];i.append("base64_image",(0,p.data2blob)(e,n),"base64_image."+this.imgFormat);var o=this.urlUpload;(0,h.default)({url:o,method:"post",data:i}).then((function(e){t.areaObject.thumb=e.data,t.updateThumb()})).catch((function(t){console.log(t)}))}.bind(this),100)},updateThumb:function(){var t=this;this.areaObject["modified"]=(new Date).toJSON(),this.areaObject["modifiedBy"]=this.currentUser,this.actUpdateThumb(this.areaObject).then((function(e){e.isSuccess&&t.getArea(t.areaObject.id)}))},selectTool:function(t){this.selectedTool=t,"addObject"===t?(this.points=[],this.formCreate.title="",this.formCreate.id=null,this.formCreate.deltax=0,this.formCreate.deltay=0,this.selectedObject={},this.points=[{x:0,y:0},{x:0,y:0},{x:0,y:0}]):(this.points=[],this.formCreate.title="",this.formCreate.id=null,this.formCreate.camera={},this.selectedObject={})},addPoint:function(t){if(("editObject"===this.selectedTool||"addObject"===this.selectedTool)&&null!==this.pointIndex){var e={x:t.offsetX,y:t.offsetY},a=JSON.parse(JSON.stringify(this.points));a[this.pointIndex]=e,this.points=[];var i,s=(0,n.default)(a);try{for(s.s();!(i=s.n()).done;){var o=i.value;this.points.push(o)}}catch(r){s.e(r)}finally{s.f()}}},getPointFill:function(t){return this.pointsColor},changePoint:function(){console.log(this.points)},addObject:function(){var t="object";if("addObject"===this.selectedTool&&(t="object"),"deleteObject"!==this.selectedTool)if("addObject"===this.selectedTool||"editObject"===this.selectedTool)if(""!==this.formCreate.title)if(null==this.formCreate.id){var e=Math.random().toString(36).slice(-6);this.objectList.push({name:this.formCreate.title,points:this.points,id:e,type:t,deltax:this.formCreate.deltax,deltay:this.formCreate.deltay}),this.saveSetting()}else{var a,i=(0,n.default)(this.objectList);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.id===this.formCreate.id){s.name=this.formCreate.title,s.points=this.points,s.deltax=this.formCreate.deltax,s.deltay=this.formCreate.deltay,this.saveSetting();break}}}catch(o){i.e(o)}finally{i.f()}}else this.$notify.warning({title:this.generateTitleView("warning","message"),message:this.generateTitleView("nameObjectRequired","createMap"),duration:3e3});else this.saveSetting();else this.saveSetting()},selectObject:function(t){this.selectedObject=t,this.points=t.points,this.formCreate.title=t.name,this.formCreate.id=t.id,this.formCreate.deltax=t.deltax,this.formCreate.deltay=t.deltay,"object"===t.type&&(this.selectedTool="editObject")},saveSetting:function(){var t=this,e=this.$refs.editorCanvas.clientHeight,a=this.$refs.editorCanvas.clientWidth;this.areaObject["modified"]=(new Date).toJSON(),this.areaObject["modifiedBy"]=this.currentUser,this.areaObject.jsonData=JSON.stringify({objectList:this.objectList,sizeMap:{w:a,h:e}}),this.actUpdateJson(this.areaObject).then((function(e){e.isSuccess&&(t.selectedTool="",t.points=[],t.formCreate.title="",t.getArea(t.areaObject.id),t.$notify.success({title:t.generateTitleView("success","message"),message:e.message,duration:2e3}))})),this.pointIndex=null},removePoint:function(t){var e=JSON.parse(JSON.stringify(this.points));e[t].x=0,e[t].y=0,this.points=[];var a,i=(0,n.default)(e);try{for(i.s();!(a=i.n()).done;){var s=a.value;this.points.push(s)}}catch(o){i.e(o)}finally{i.f()}},removeObject:function(t){this.selectedTool="deleteObject",this.objectList.splice(t,1),this.formCreate={title:"",id:null},this.points=[]},showMapSetting:function(){this.dialogMapSetting=!0},saveMapSetting:function(){var t=this;this.areaObject["modified"]=(new Date).toJSON(),this.areaObject["modifiedBy"]=this.currentUser,this.actEditArea(this.areaObject).then((function(e){e.isSuccess?(t.$notify.success({title:t.generateTitleView("success","message"),message:t.generateTitleView("successMessage","message"),duration:2e3}),t.dialogMapSetting=!1):(t.$notify.error({title:t.generateTitleView("error","message"),message:t.generateTitleView("errorMessage","message"),duration:2e3}),t.dialogMapSetting=!1)}))},setPoint:function(t){this.pointIndex=t}})};e.default=v},f172:function(t,e,a){"use strict";var i=a("153d"),s=a.n(i);s.a}}]);